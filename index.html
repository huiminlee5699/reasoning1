<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f7f7f8;
            color: #374151;
            height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 260px;
            background-color: #f3f4f6;
            padding: 8px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #4b5563;
        }

        .new-chat-btn {
            background-color: transparent;
            border: 1px solid #4b5563;
            color: #ececf1;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .new-chat-btn:hover {
            background-color: #374151;
        }

        .sidebar-items {
            flex: 1;
            overflow-y: auto;
        }

        .sidebar-item {
            padding: 12px;
            color: #374151;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-item:hover {
            background-color: #374151;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 768px;
            margin: 0 auto;
            width: 100%;
        }

        .welcome-screen {
            text-align: center;
            margin-top: 20vh;
            margin-bottom: 2rem;
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 32px;
            color: #374151;
        }

        .message {
            width: 100%;
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            align-items: flex-start;
        }

        .message.user {
            background-color: #f0f0f0;
            padding: 12px 16px;
            border-radius: 18px;
            margin-left: auto;
            max-width: 70%;
            display: block;
        }

        .message.assistant {
            background-color: transparent;
            width: 100%;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
            margin-top: 4px;
        }

        .assistant-avatar {
            background-color: #10a37f;
            color: white;
        }

        .message-content {
            flex: 1;
            line-height: 1.6;
        }

        .thinking-container {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            background-color: white;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .thinking-header {
            padding: 16px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 500;
            background-color: #fafafa;
            border-bottom: 1px solid #e5e7eb;
            user-select: none;
            transition: background-color 0.2s;
        }

        .thinking-header:hover {
            background-color: #f0f0f0;
        }

        .thinking-header.completed {
            background-color: #f0f9f4;
            color: #059669;
            border-bottom: 1px solid #d1fae5;
        }

        .thinking-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .thinking-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: pulse 1.5s infinite;
        }

        .thinking-status.completed {
            background-color: #10b981;
            animation: none;
        }

        .thinking-chevron {
            transition: transform 0.2s;
            color: #6b7280;
        }

        .thinking-chevron.expanded {
            transform: rotate(180deg);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .thinking-content {
            padding: 20px;
            display: none;
            line-height: 1.6;
        }

        .thinking-content.expanded {
            display: block;
        }

        .thinking-content p {
            margin-bottom: 16px;
            color: #374151;
        }

        .thinking-content p:last-child {
            margin-bottom: 0;
        }

        .final-answer {
            margin-top: 16px;
            line-height: 1.7;
        }

        .final-answer h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #111827;
        }

        .final-answer h4 {
            font-size: 16px;
            font-weight: 600;
            margin: 20px 0 12px 0;
            color: #111827;
        }

        .final-answer p {
            margin-bottom: 16px;
            color: #374151;
        }

        .final-answer ul {
            margin: 16px 0;
            padding-left: 20px;
        }

        .final-answer li {
            margin-bottom: 8px;
            color: #374151;
        }

        .final-answer strong {
            font-weight: 600;
            color: #111827;
        }

        .skip-button {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 12px;
            transition: background-color 0.2s;
        }

        .skip-button:hover {
            background-color: #e5e7eb;
        }

        .input-container {
            position: sticky;
            bottom: 0;
            background-color: #f7f7f8;
            padding: 20px;
            max-width: 768px;
            width: 100%;
            margin: 0 auto;
        }

        .input-wrapper {
            position: relative;
            background-color: white;
            border-radius: 24px;
            border: 1px solid #d1d5db;
            display: flex;
            align-items: flex-end;
            padding: 12px;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-height: 56px;
        }

        .input-wrapper.drag-over {
            border-color: #10a37f;
            background-color: #f0fdf4;
        }

        .input-field {
            flex: 1;
            background: transparent;
            border: none;
            color: #374151;
            font-size: 16px;
            resize: none;
            outline: none;
            min-height: 24px;
            max-height: 200px;
            line-height: 1.5;
            padding: 8px 12px;
        }

        .input-field::placeholder {
            color: #9ca3af;
        }

        .file-input {
            display: none;
        }

        .file-label {
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            color: #6b7280;
        }

        .file-label:hover {
            background-color: #f3f4f6;
        }

        .send-btn {
            background-color: #10a37f;
            border: none;
            border-radius: 50%;
            padding: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            width: 32px;
            height: 32px;
        }

        .send-btn:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }

        .file-status {
            font-size: 12px;
            color: #10a37f;
            margin-top: 4px;
            text-align: center;
        }

        .drop-zone {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(16, 163, 127, 0.1);
            border: 2px dashed #10a37f;
            border-radius: 24px;
            display: none;
            align-items: center;
            justify-content: center;
            color: #10a37f;
            font-weight: 500;
            pointer-events: none;
        }

        .drop-zone.active {
            display: flex;
        }

        .hidden {
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding: 8px 0;
        }

        .action-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .action-btn:hover {
            background-color: #f3f4f6;
        }

        .feedback-bar {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            color: #6b7280;
        }

        .feedback-buttons {
            display: flex;
            gap: 8px;
        }

        .feedback-btn {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .feedback-btn:hover {
            background-color: #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <button class="new-chat-btn">
            <span>+</span>
            New chat
        </button>
        
        <div class="sidebar-items">
            <div class="sidebar-item">
                <span>üîç</span>
                Search chats
            </div>
            <div class="sidebar-item">
                <span>üìö</span>
                Library
            </div>
            <div class="sidebar-item">
                <span>‚öôÔ∏è</span>
                GPTs
            </div>
        </div>
        
        <div style="margin-top: auto; padding-top: 16px; border-top: 1px solid #d1d5db;">
            <div class="sidebar-item">
                <div style="width: 32px; height: 32px; border-radius: 50%; background-color: #10a37f; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                    U
                </div>
                User
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="chat-container" id="chatContainer">
            <div class="welcome-screen" id="welcomeScreen">
                <h1 class="welcome-title">What can I help with?</h1>
            </div>
        </div>

        <div class="input-container">
            <div class="input-wrapper" id="inputWrapper">
                <label for="fileInput" class="file-label">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10,9 9,9 8,9"></polyline>
                    </svg>
                </label>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv">
                <textarea 
                    id="messageInput" 
                    class="input-field" 
                    placeholder="Message ChatGPT"
                    rows="1"
                ></textarea>
                <button id="sendBtn" class="send-btn" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22,2 15,22 11,13 2,9"></polygon>
                    </svg>
                </button>
                <div class="drop-zone" id="dropZone">
                    Drop your file here
                </div>
            </div>
            <div class="file-status" id="fileStatus"></div>
        </div>
    </div>

    <script>
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatContainer = document.getElementById('chatContainer');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const fileInput = document.getElementById('fileInput');
        const fileStatus = document.getElementById('fileStatus');
        const inputWrapper = document.getElementById('inputWrapper');
        const dropZone = document.getElementById('dropZone');

        let uploadedFile = null;
        let isProcessing = false;

        const targetQuestion = "You work for an international education nonprofit focused on strengthening online learning after COVID-19. Your team must decide whether to direct resources to Indonesia or Nigeria. Using the data on GDP growth and school enrollment, which country should your NGO prioritize, and why would additional support for digital and online learning have the greatest impact there?";

        const reasoningContent = {
            thinking: [
                "I'll open the uploaded Excel file to read and analyze data on GDP growth and school enrollment. I'll check trends, compute averages, maybe visualize with a table or simple chart. I'll inspect columns and assess which factors should be prioritized for digital learning impact. Let's proceed by loading all sheet data.",
                "I'll present concise results and a recommendation in chat. The plan is to calculate the latest 5-year GDP growth and enrollment data, then derive a combined need index, focusing on lower enrollment and strong GDP growth. The goal is to prioritize countries where digital learning can make the most impact."
            ],
            analyzing: [
                "From the data, Nigeria has lower primary enrollment and moderate GDP growth, suggesting that digital learning could expand access and improve education. Indonesia, with near-universal primary enrollment, benefits more from quality improvements. The recommendation is to prioritize Nigeria, focusing on addressing the enrollment gap and leveraging its growth potential."
            ]
        };

        const finalResponse = `Short answer: **Nigeria.**

**Why (from your file):**

‚Ä¢ **Primary enrollment gap:** Latest available gross enrollment is ~**86.7% in Nigeria (2021)** vs ~**100.2% in Indonesia (2023)**. Indonesia is already at (or above) universal primary enrollment; Nigeria still has a sizable access gap to close. (I analyzed your "Indo vs Nigeria.xlsx" and shared a compact summary table in the workspace.)

‚Ä¢ **Recent trajectory:** Since 2015, **Nigeria is up ~+3.0 points**, while **Indonesia is down ~‚Äì9.1 points** (a correction from previously >100% gross). This means the *marginal impact* of pulling more learners in‚Äîespecially the hardest-to-reach‚Äîwill be higher in Nigeria.

‚Ä¢ **Macro capacity:** Average **GDP growth (2020‚Äì2024)** is **~2.3% for Nigeria** vs **~3.4% for Indonesia**; Nigeria's **latest (2024) growth ~3.43%** is improving but still leaves limited fiscal space. External support to digital learning is more catalytic where public budgets are tighter and baseline enrollment is lower.

**Why digital/online learning moves the needle more in Nigeria**

Given lower enrollment and improving but constrained macro resources, targeted digital approaches can unlock access and retention at scale:

1. **Reach out-of-school children** with *offline-first* mobile learning bundles (preloaded devices, SD-card content), radio/TV + SMS bridging, and community digital hubs‚Äîespecially in rural and conflict-affected areas.

2. **Teacher support at scale:** WhatsApp/low-bandwidth CPD, micro-credentials, and templated digital lesson plans to mitigate shortages and variability in instructional quality.

3. **Girls' participation:** Safety-aware home-based modules, guardians' messaging, and asynchronous schedules reduce drop-out during household labour or caregiving peaks.

4. **Cost/leverage:** Zero-rating of core learning platforms with MNOs, shared/solar charging, and device rotation models deliver large enrollment/attendance gains per dollar.

5. **Data for action:** Simple attendance/usage dashboards (USSD/SMS fallbacks) to identify disengagement early.

**Suggested initial KPIs (12‚Äì18 months, Nigeria):**

‚Ä¢ +6‚Äì10 pp increase in primary participation in target LGAs
‚Ä¢ ‚â•60% weekly active learners on offline/low-data apps
‚Ä¢ ‚â•70% teacher completion of micro-CPD modules; ‚â•0.25 SD improvement on basic literacy/numeracy in sampled schools
‚Ä¢ 1‚Äì2 telecom zero-rating agreements; device uptime ‚â•90% via solar/charging solutions

**Bottom line:** With Indonesia already near-universal primary enrollment, your resources will have **greater additional impact in Nigeria**, where digital solutions can convert large access gaps into real learning gains and do so cost-effectively.`;

        function updateSendButton() {
            const hasText = messageInput.value.trim().length > 0;
            sendBtn.disabled = !hasText || isProcessing;
        }

        function autoResize() {
            messageInput.style.height = 'auto';
            messageInput.style.height = messageInput.scrollHeight + 'px';
        }

        function addUserMessage(content) {
            welcomeScreen.classList.add('hidden');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.textContent = content;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function createThinkingSection(title, isActive = false, isCompleted = false) {
            const container = document.createElement('div');
            container.className = 'thinking-container';
            
            const header = document.createElement('div');
            header.className = `thinking-header ${isCompleted ? 'completed' : ''}`;
            
            const titleDiv = document.createElement('div');
            titleDiv.className = 'thinking-title';
            
            const status = document.createElement('div');
            status.className = `thinking-status ${isCompleted ? 'completed' : ''}`;
            
            const titleSpan = document.createElement('span');
            titleSpan.textContent = title;
            
            const chevron = document.createElement('div');
            chevron.className = `thinking-chevron ${isActive ? 'expanded' : ''}`;
            chevron.innerHTML = '‚ñº';
            
            titleDiv.appendChild(status);
            titleDiv.appendChild(titleSpan);
            header.appendChild(titleDiv);
            header.appendChild(chevron);
            
            const content = document.createElement('div');
            content.className = `thinking-content ${isActive ? 'expanded' : ''}`;
            
            container.appendChild(header);
            container.appendChild(content);
            
            header.addEventListener('click', () => {
                content.classList.toggle('expanded');
                chevron.classList.toggle('expanded');
            });
            
            return { container, content, header, status, chevron };
        }

        function addThinkingContent(contentDiv, items) {
            items.forEach(item => {
                const p = document.createElement('p');
                p.textContent = item;
                contentDiv.appendChild(p);
            });
        }

        function createSkipButton(callback) {
            const button = document.createElement('button');
            button.className = 'skip-button';
            button.textContent = 'Skip for a quicker response';
            button.addEventListener('click', callback);
            return button;
        }

        function typeText(element, text, speed = 8) {
            return new Promise(resolve => {
                element.innerHTML = '';
                const words = text.split(' ');
                let currentIndex = 0;
                
                function typeNextChunk() {
                    if (currentIndex >= words.length) {
                        resolve();
                        return;
                    }
                    
                    // Randomly decide chunk size
                    const rand = Math.random();
                    let chunkSize;
                    
                    if (rand < 0.3) {
                        chunkSize = 1; // Single word
                    } else if (rand < 0.7) {
                        chunkSize = Math.min(4, words.length - currentIndex); // 3-4 words
                    } else {
                        chunkSize = Math.min(12, words.length - currentIndex); // Full phrase/line
                    }
                    
                    const chunk = words.slice(currentIndex, currentIndex + chunkSize).join(' ');
                    const currentText = words.slice(0, currentIndex).join(' ');
                    const newText = currentText + (currentText ? ' ' : '') + chunk;
                    
                    element.innerHTML = formatResponse(newText);
                    currentIndex += chunkSize;
                    
                    setTimeout(typeNextChunk, speed * chunkSize);
                }
                
                typeNextChunk();
            });
        }

        function formatResponse(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/‚Ä¢ /g, '&bull; ')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^/, '<p>')
                .replace(/$/, '</p>');
        }

        async function showReasoningProcess(skipReasoning = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message assistant';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar assistant-avatar';
            avatar.textContent = 'AI';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatContainer.appendChild(messageDiv);
            
            let skipped = false;
            
            if (!skipReasoning) {
                // Create thinking section
                const thinkingSection = createThinkingSection('Thinking', true);
                messageContent.appendChild(thinkingSection.container);
                
                // Add skip button
                const skipButton = createSkipButton(() => {
                    skipped = true;
                });
                messageContent.appendChild(skipButton);
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Wait 2 seconds, then add thinking content
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                if (!skipped) {
                    addThinkingContent(thinkingSection.content, reasoningContent.thinking);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    // Wait 6 more seconds (total 8s for thinking)
                    await new Promise(resolve => setTimeout(resolve, 6000));
                }
                
                if (!skipped) {
                    // Create analyzing section
                    const analyzingSection = createThinkingSection('Analyzing', true);
                    messageContent.appendChild(analyzingSection.container);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    // Wait 2 seconds, then add analyzing content
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    if (!skipped) {
                        addThinkingContent(analyzingSection.content, reasoningContent.analyzing);
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                        
                        // Wait 10 more seconds (total 12s for analyzing)
                        await new Promise(resolve => setTimeout(resolve, 10000));
                    }
                    
                    // Update headers to completed state
                    thinkingSection.header.classList.add('completed');
                    thinkingSection.status.classList.add('completed');
                    thinkingSection.header.querySelector('span').textContent = 'Thought for 8s';
                    
                    analyzingSection.header.classList.add('completed');
                    analyzingSection.status.classList.add('completed');
                    analyzingSection.header.querySelector('span').textContent = 'Thought for 12s';
                    
                    // Remove skip button
                    skipButton.remove();
                } else {
                    // If skipped, wait remaining time to reach 20s total
                    const remainingTime = 20000 - 2000; // 18 seconds remaining
                    await new Promise(resolve => setTimeout(resolve, remainingTime));
                    
                    // Still update to completed state
                    thinkingSection.header.classList.add('completed');
                    thinkingSection.status.classList.add('completed');
                    thinkingSection.header.querySelector('span').textContent = 'Thought for 8s';
                    
                    skipButton.remove();
                }
            } else {
                // If skipping reasoning, still wait 20s
                await new Promise(resolve => setTimeout(resolve, 20000));
            }
            
            // Show final answer
            const finalAnswerDiv = document.createElement('div');
            finalAnswerDiv.className = 'final-answer';
            messageContent.appendChild(finalAnswerDiv);
            
            await typeText(finalAnswerDiv, finalResponse);
            
            // Add action buttons
            const actionButtons = document.createElement('div');
            actionButtons.className = 'action-buttons';
            actionButtons.innerHTML = `
                <button class="action-btn">üìã</button>
                <button class="action-btn">üëç</button>
                <button class="action-btn">üëé</button>
                <button class="action-btn">‚ÜóÔ∏è</button>
                <button class="action-btn">üîÑ</button>
                <button class="action-btn">‚ãØ</button>
            `;
            messageContent.appendChild(actionButtons);
            
            // Add feedback bar
            const feedbackBar = document.createElement('div');
            feedbackBar.className = 'feedback-bar';
            feedbackBar.innerHTML = `
                <span>Is this conversation helpful so far?</span>
                <div class="feedback-buttons">
                    <button class="feedback-btn">üëç</button>
                    <button class="feedback-btn">üëé</button>
                    <button class="feedback-btn">‚úï</button>
                </div>
            `;
            messageContent.appendChild(feedbackBar);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            if (isProcessing) return;
            
            const message = messageInput.value.trim();
            if (!message) return;

            isProcessing = true;
            updateSendButton();
            
            addUserMessage(message);
            messageInput.value = '';
            autoResize();

            // Check if this matches our target question and a file is uploaded
            const isTargetQuestion = message.toLowerCase().includes('indonesia') && 
                                   message.toLowerCase().includes('nigeria') && 
                                   message.toLowerCase().includes('education') &&
                                   uploadedFile;

            if (isTargetQuestion) {
                await showReasoningProcess();
            } else {
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message assistant';
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar assistant-avatar';
                avatar.textContent = 'AI';
                
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content final-answer';
                
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
                chatContainer.appendChild(messageDiv);
                
                await typeText(messageContent, "I'm a simulation of ChatGPT created for research purposes. Please ask the specific question about Indonesia vs Nigeria with an uploaded file to see the demonstration response.");
            }
            
            isProcessing = false;
            updateSendButton();
        }

        // Event listeners
        messageInput.addEventListener('input', () => {
            updateSendButton();
            autoResize();
        });

        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!sendBtn.disabled) {
                    sendMessage();
                }
            }
        });

        sendBtn.addEventListener('click', sendMessage);

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                uploadedFile = file;
                fileStatus.textContent = `üìé ${file.name} uploaded`;
            } else {
                uploadedFile = null;
                fileStatus.textContent = '';
            }
        });

        // Drag and drop functionality
        inputWrapper.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('active');
            inputWrapper.classList.add('drag-over');
        });

        inputWrapper.addEventListener('dragleave', (e) => {
            if (!inputWrapper.contains(e.relatedTarget)) {
                dropZone.classList.remove('active');
                inputWrapper.classList.remove('drag-over');
            }
        });

        inputWrapper.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('active');
            inputWrapper.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls') || file.name.endsWith('.csv')) {
                    uploadedFile = file;
                    fileStatus.textContent = `üìé ${file.name} uploaded`;
                }
            }
        });

        // Initialize
        updateSendButton();
    </script>
</body>
</html>
